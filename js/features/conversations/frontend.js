!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=304)}({304:function(e,t,n){e.exports=n(305)},305:function(e,t,n){"use strict";n.r(t);n(306),n(307)},306:function(e,t){!function(e,t){"use strict";t.extend(t.fn,{concreteConversation:function(e){return this.each((function(){var n=t(this),a=n.data("concreteConversation");a||n.data("concreteConversation",a=new o(n,e))}))}});var n={Confirm_remove_message:"Remove this message? Replies to it will not be removed.",Confirm_mark_as_spam:"Are you sure you want to flag this message as spam?",Warn_currently_editing:"Please complete or cancel the current message editing session before editing this message.",Unspecified_error_occurred:"An unspecified error occurred.",Error_deleting_message:"Something went wrong while deleting this message, please refresh and try again.",Error_flagging_message:"Something went wrong while flagging this message, please refresh and try again."};t.fn.concreteConversation.localize=function(e){t.extend(!0,n,e)};var o=function(e,t){this.publish("beforeInitializeConversation",{element:e,options:t}),this.init(e,t),this.publish("initializeConversation",{element:e,options:t})};o.fn=o.prototype={publish:function(e,t){(t=t||{}).ConcreteConversation=this,window.ConcreteEvent.publish(e,t)},init:function(e,n){var o=this;o.$element=e,o.options=t.extend({method:"ajax",paginate:!1,displayMode:"threaded",itemsPerPage:-1,activeUsers:[],uninitialized:!0,deleteMessageToken:null,addMessageToken:null,editMessageToken:null,flagMessageToken:null},n);var a=""!=o.options.addMessageToken?1:0,i=o.options.paginate?1:0,s=o.options.orderBy,r=o.options.enableOrdering,c=o.options.displayPostingForm,l=o.options.enableCommentRating,d=o.options.enableTopCommentReviews,m=o.options.displaySocialLinks,p=o.options.addMessageLabel?o.options.addMessageLabel:"",v=o.options.dateFormat,u=o.options.customDateFormat,g=o.options.blockAreaHandle,h=o.options.attachmentsEnabled,f=o.options.attachmentOverridesEnabled;"ajax"==o.options.method?t.post(CCM_TOOLS_PATH+"/conversations/view_ajax",{cnvID:o.options.cnvID,cID:o.options.cID,blockID:o.options.blockID,enablePosting:a,itemsPerPage:o.options.itemsPerPage,addMessageLabel:p,paginate:i,displayMode:o.options.displayMode,orderBy:s,enableOrdering:r,displayPostingForm:c,enableCommentRating:l,enableTopCommentReviews:d,displaySocialLinks:m,dateFormat:v,customDateFormat:u,blockAreaHandle:g,attachmentsEnabled:h,attachmentOverridesEnabled:f},(function(e){var n=window.obj;window.obj=o,o.$element.empty().append(e);var a=window.location.hash.match(/^#cnv([0-9]+)Message[0-9]+$/);if(null!==a&&a[1]==o.options.cnvID){var i=t("a"+window.location.hash).offset();t("html, body").animate({scrollTop:i.top},800,"linear")}window.obj=n,o.attachBindings(),o.publish("conversationLoaded")})):(o.attachBindings(),o.finishSetup(),o.publish("conversationLoaded"))},mentionList:function(e,n,o){var a=this;if(n){if(a.dropdown.parent.css({top:n.y,left:n.x}),0==e.length)return a.dropdown.handle.dropdown("toggle"),a.dropdown.parent.remove(),a.dropdown.active=!1,void(a.dropdown.activeItem=-1);a.dropdown.list.empty(),e.slice(0,20).map((function(e){var n=t("<li/>");t("<a/>").appendTo(n).text(e.getName()).click((function(){ConcreteEvent.fire("ConversationMentionSelect",{obj:a,item:e},o)})),n.appendTo(a.dropdown.list)})),a.dropdown.active||(a.dropdown.active=!0,a.dropdown.activeItem=-1,a.dropdown.parent.appendTo(a.$element),a.dropdown.handle.dropdown("toggle")),a.dropdown.activeItem>=0&&a.dropdown.list.children().eq(a.dropdown.activeItem).addClass("active")}},attachSubscriptionBindings:function(){t("a[data-conversation-subscribe]").magnificPopup({type:"ajax",callbacks:{updateStatus:function(e){if("ready"==e.status){var n=t("form[data-conversation-form=subscribe]");t("button").on("click",n,(function(e){e.preventDefault(),e.stopPropagation(),t.ajax({url:n.attr("action"),dataType:"json",success:function(e){e.subscribed?(t("[data-conversation-subscribe=subscribe]").hide(),t("[data-conversation-subscribe=unsubscribe]").show()):(t("[data-conversation-subscribe=unsubscribe]").hide(),t("[data-conversation-subscribe=subscribe]").show()),t.magnificPopup.close()}})}))}},beforeOpen:function(){this.st.mainClass="mfp-zoom-in"}},closeOnContentClick:!0,midClick:!0})},attachBindings:function(){var e=this;e.$element.unbind(".cnv"),e.options.uninitialized&&(e.options.uninitialized=!1,ConcreteEvent.bind("ConversationMention",(function(t,n){e.mentionList(n.items,n.coordinates||!1,n.bindTo||e.$element.get(0))}),e.$element.get(0)),e.dropdown={},e.dropdown.parent=t("<div/>").css({position:"absolute",height:0,width:0}),e.dropdown.active=!1,e.dropdown.handle=t("<a/>").appendTo(e.dropdown.parent),e.dropdown.list=t("<ul/>").addClass("dropdown-menu").appendTo(e.dropdown.parent),e.dropdown.handle.dropdown(),ConcreteEvent.bind("ConversationTextareaKeydownUp",(function(t){-1==e.dropdown.activeItem&&(e.dropdown.activeItem=e.dropdown.list.children().length),e.dropdown.activeItem-=1,e.dropdown.activeItem+=e.dropdown.list.children().length,e.dropdown.activeItem%=e.dropdown.list.children().length,e.dropdown.list.children().filter(".active").removeClass("active").end().eq(e.dropdown.activeItem).addClass("active")}),e.$element.get(0)),ConcreteEvent.bind("ConversationTextareaKeydownDown",(function(t){e.dropdown.activeItem+=1,e.dropdown.activeItem+=e.dropdown.list.children().length,e.dropdown.activeItem%=e.dropdown.list.children().length,e.dropdown.list.children().filter(".active").removeClass("active").end().eq(e.dropdown.activeItem).addClass("active")}),e.$element.get(0)),ConcreteEvent.bind("ConversationTextareaKeydownEnter",(function(t){e.dropdown.list.children().filter(".active").children("a").click()}),e.$element.get(0)),ConcreteEvent.bind("ConversationPostError",(function(e,n){var o=n.form,a=n.messages,i="";t.each(a,(function(e,t){i+=t+"<br>"})),o.find("div.ccm-conversation-errors").html(i).show()})),ConcreteEvent.bind("ConversationSubmitForm",(function(e,t){t.form.find("div.ccm-conversation-errors").hide()})));var o=e.options.paginate?1:0,a=""!=e.options.addMessageToken?1:0,i=e.options.addMessageLabel?e.options.addMessageLabel:"";e.$replyholder=e.$element.find("div.ccm-conversation-add-reply"),e.$newmessageform=e.$element.find("div.ccm-conversation-add-new-message form"),e.$deleteholder=e.$element.find("div.ccm-conversation-delete-message"),e.$attachmentdeleteholder=e.$element.find("div.ccm-conversation-delete-attachment"),e.$permalinkholder=e.$element.find("div.ccm-conversation-message-permalink"),e.$messagelist=e.$element.find("div.ccm-conversation-message-list"),e.$messagecnt=e.$element.find(".ccm-conversation-message-count"),e.$postbuttons=e.$element.find("[data-submit=conversation-message]"),e.$sortselect=e.$element.find("select[data-sort=conversation-message-list]"),e.$loadmore=e.$element.find("[data-load-page=conversation-message-list]"),e.$messages=e.$element.find(".ccm-conversation-messages"),e.$messagerating=e.$element.find("span.ccm-conversation-message-rating"),e.$element.on("click.cnv","[data-submit=conversation-message]",(function(n){n.preventDefault(),e.submitForm(t(this))})),e.$element.on("click.cnv","[data-submit=update-conversation-message]",(function(){return e.submitUpdateForm(t(this)),!1})),this.attachSubscriptionBindings();var s=1;e.$element.on("click.cnv","a[data-toggle=conversation-reply]",(function(n){n.preventDefault(),t(".ccm-conversation-attachment-container").each((function(){t(this).is(":visible")&&t(this).toggle()}));var o=e.$replyholder.appendTo(t(this).closest("[data-conversation-message-id]"));return o.attr("data-form","conversation-reply").show(),o.find("[data-submit=conversation-message]").attr("data-post-parent-id",t(this).attr("data-post-parent-id")),o.attr("rel","new-reply"+s),s++,!1})),t(".ccm-conversation-attachment-container").hide(),t(".ccm-conversation-add-new-message .ccm-conversation-attachment-toggle").off("click.cnv").on("click.cnv",(function(e){e.preventDefault(),t(".ccm-conversation-add-reply .ccm-conversation-attachment-container").is(":visible")&&t(".ccm-conversation-add-reply .ccm-conversation-attachment-container").toggle(),t(".ccm-conversation-add-new-message .ccm-conversation-attachment-container").toggle()})),t(".ccm-conversation-add-reply .ccm-conversation-attachment-toggle").off("click.cnv").on("click.cnv",(function(e){e.preventDefault(),t(".ccm-conversation-add-new-message .ccm-conversation-attachment-container").is(":visible")&&t(".ccm-conversation-add-new-message .ccm-conversation-attachment-container").toggle(),t(".ccm-conversation-add-reply .ccm-conversation-attachment-container").toggle()})),e.$element.on("click.cnv","a[data-submit=delete-conversation-message]",(function(){var o=t(this);return e.$deletedialog=e.$deleteholder.clone(),e.$deletedialog.dialog?e.$deletedialog.dialog({modal:!0,dialogClass:"ccm-conversation-dialog",title:e.$deleteholder.attr("data-dialog-title"),buttons:[{text:e.$deleteholder.attr("data-cancel-button-title"),class:"btn pull-left",click:function(){e.$deletedialog.dialog("close")}},{text:e.$deleteholder.attr("data-confirm-button-title"),class:"btn pull-right btn-danger",click:function(){e.deleteMessage(o.attr("data-conversation-message-id"))}}]}):window.confirm(n.Confirm_remove_message)&&e.deleteMessage(o.attr("data-conversation-message-id")),!1})),e.$element.on("click.cnv","a[data-submit=flag-conversation-message]",(function(){var o=t(this);return window.confirm(n.Confirm_mark_as_spam)&&e.flagMessage(o.attr("data-conversation-message-id")),!1})),e.$element.on("click.cnv","a[data-load=edit-conversation-message]",(function(){if(t(".ccm-conversation-edit-message").is(":visible"))return window.alert(n.Warn_currently_editing),!1;var o=t(this);e.editMessage(o.attr("data-conversation-message-id"))})),e.$element.on("change.cnv","select[data-sort=conversation-message-list]",(function(){e.$messagelist.load(CCM_TOOLS_PATH+"/conversations/view_ajax",{cnvID:e.options.cnvID,task:"get_messages",cID:e.options.cID,blockID:e.options.blockID,enablePosting:a,displayMode:e.options.displayMode,itemsPerPage:e.options.itemsPerPage,paginate:o,addMessageLabel:i,orderBy:t(this).val(),enableOrdering:e.options.enableOrdering,displayPostingForm:e.options.displayPostingForm,enableCommentRating:e.options.enableCommentRating,enableTopCommentReviews:e.options.enableTopCommentReviews,displaySocialLinks:e.options.displaySocialLinks,dateFormat:e.options.dateFormat,customDateFormat:e.options.customDateFormat,blockAreaHandle:e.options.blockAreaHandle,attachmentsEnabled:e.options.attachmentsEnabled,attachmentOverridesEnabled:e.options.attachmentOverridesEnabled},(function(n){e.$replyholder.appendTo(e.$element),t(".ccm-conversation-messages .dropdown-toggle").dropdown(),e.attachBindings()}))})),e.$element.on("click.cnv",".image-popover-hover",(function(){t.magnificPopup.open({items:{src:t(this).attr("data-full-image"),type:"image",verticalFit:!0}})})),e.$element.on("click.cnv","[data-load-page=conversation-message-list]",(function(){var n=parseInt(e.$loadmore.attr("data-next-page")),o=parseInt(e.$loadmore.attr("data-total-pages")),s=e.$sortselect.length?e.$sortselect.val():e.options.orderBy,r={cnvID:e.options.cnvID,cID:e.options.cID,blockID:e.options.blockID,itemsPerPage:e.options.itemsPerPage,displayMode:e.options.displayMode,blockAreaHandle:e.options.blockAreaHandle,enablePosting:a,addMessageLabel:i,page:n,orderBy:s,enableCommentRating:e.options.enableCommentRating,enableTopCommentReviews:e.options.enableTopCommentReviews,displaySocialLinks:e.options.displaySocialLinks,dateFormat:e.options.dateFormat,customDateFormat:e.options.customDateFormat,attachmentsEnabled:e.options.attachmentsEnabled,attachmentOverridesEnabled:e.options.attachmentOverridesEnabled};t.ajax({type:"post",data:r,url:CCM_TOOLS_PATH+"/conversations/message_page",success:function(a){e.$messages.append(a),t(".ccm-conversation-messages .dropdown-toggle").dropdown(),n+1>o?e.$loadmore.hide():e.$loadmore.attr("data-next-page",n+1)}})})),e.$element.on("click.cnv",".conversation-rate-message",(function(){var n=t(this).closest("[data-conversation-message-id]").attr("data-conversation-message-id"),o=t(this).attr("data-conversation-rating-type");e.$messagerating.load(CCM_TOOLS_PATH+"/conversations/rate");var a={cnvID:e.options.cnvID,cID:e.options.cID,blockID:e.options.blockID,cnvMessageID:n,cnvRatingTypeHandle:o};t.ajax({type:"post",data:a,url:CCM_TOOLS_PATH+"/conversations/rate",success:function(e){t('span[data-message-rating="'+n+'"]').load(CCM_TOOLS_PATH+"/conversations/get_rating",{cnvMessageID:n})}})})),e.$element.on("click.cnv","a.share-popup",(function(){var e=null!=window.screenLeft?window.screenLeft:screen.left,n=null!=window.screenTop?window.screenTop:screen.top,o=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-300+e,a=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-125+n;return window.open(t(this).attr("href"),"cnvSocialShare","left:"+o+",top:"+a+",height=250,width=600,toolbar=no,status=no"),!1})),e.$element.on("click.cnv","a.share-permalink",(function(){var n=t(this).attr("rel");e.$permalinkdialog=e.$permalinkholder.clone();var o=t("<textarea readonly>").text(decodeURIComponent(n));return e.$permalinkdialog.append(o),o.click((function(){var e=t(this);e.select(),window.setTimeout((function(){e.select()}),1),e.mouseup((function(){return e.unbind("mouseup"),!1}))})),e.$permalinkdialog.dialog&&e.$permalinkdialog.dialog({modal:!0,dialogClass:"ccm-conversation-dialog",title:e.$permalinkholder.attr("data-dialog-title"),buttons:[{text:e.$permalinkholder.attr("data-cancel-button-title"),class:"btn pull-left",click:function(){e.$permalinkdialog.dialog("close")}}]}),!1})),e.options.attachmentsEnabled>0&&e.$element.concreteConversationAttachments(e),t(".dropdown-toggle").dropdown()},handlePostError:function(e,t){t||(t=[n.Unspecified_error_occurred]),this.publish("conversationPostError",{form:e,messages:t})},deleteMessage:function(e){var o=this;o.publish("conversationBeforeDeleteMessage",{msgID:e});var a=[{name:"cnvMessageID",value:e},{name:"token",value:o.options.deleteMessageToken}];t.ajax({type:"post",data:a,dataType:"json",url:CCM_TOOLS_PATH+"/conversations/delete_message",success:function(a){if(a.error)window.alert(n.Error_deleting_message+"\n\n"+a.errors.join("\n"));else{var i=t("[data-conversation-message-id="+e+"]");i.length&&i.remove(),o.updateCount(),o.$deletedialog.dialog&&o.$deletedialog.dialog("close"),o.publish("conversationDeleteMessage",{msgID:e})}},error:function(t){o.publish("conversationDeleteMessageError",{msgID:e,error:arguments}),window.alert(n.Error_deleting_message)}})},editMessage:function(e){var n=this,o=[{name:"cnvMessageID",value:e},{name:"cID",value:this.options.cID},{name:"blockAreaHandle",value:this.options.blockAreaHandle},{name:"bID",value:this.options.blockID}];t.ajax({type:"post",data:o,url:CCM_TOOLS_PATH+"/conversations/edit_message",success:function(o){var a=t(".ccm-conversation-message[data-conversation-message-id="+e+"]"),i=a;a.after(o).remove(),t(".ccm-conversation-attachment-container").hide(),t(".ccm-conversation-edit-message .ccm-conversation-attachment-toggle").off("click.cnv").on("click.cnv",(function(e){e.preventDefault(),t(".ccm-conversation-edit-message .ccm-conversation-attachment-container").toggle()})),n.$editMessageHolder=n.$element.find("div.ccm-conversation-edit-message"),n.$element.concreteConversationAttachments(n),t("button.cancel-update").on("click.cnv",(function(){t(".ccm-conversation-edit-message").replaceWith(i)}))},error:function(t){n.publish("conversationEditMessageError",{msgID:e,error:arguments})}})},flagMessage:function(e){var o=this;o.publish("conversationBeforeFlagMessage",{msgID:e});var a=[{name:"token",value:o.options.flagMessageToken},{name:"cnvMessageID",value:e}];t.ajax({type:"post",data:a,url:CCM_TOOLS_PATH+"/conversations/flag_message",success:function(n){var a=t(".ccm-conversation-message[data-conversation-message-id="+e+"]");a.length&&a.after(n).remove(),o.updateCount(),o.publish("conversationFlagMessage",{msgID:e})},error:function(t){o.publish("conversationFlagMessageError",{msgID:e,error:arguments}),window.alert(n.Error_flagging_message)}})},addMessageFromJSON:function(e,n){var o=this;o.publish("conversationBeforeAddMessageFromJSON",{json:n,form:e});var a=""!=o.options.addMessageToken?1:0,i=[{name:"cnvMessageID",value:n.cnvMessageID},{name:"enablePosting",value:a},{name:"displayMode",value:o.options.displayMode},{name:"enableCommentRating",value:o.options.enableCommentRating},{name:"displaySocialLinks",value:o.options.displaySocialLinks}];t.ajax({type:"post",data:i,url:CCM_TOOLS_PATH+"/conversations/message_detail",success:function(a){var i=t(".ccm-conversation-message[data-conversation-message-id="+n.cnvMessageParentID+"]");if(i.length){i.after(a),o.$replyholder.appendTo(o.$element),o.$replyholder.hide(),o.$replyholder.find(".conversation-editor").val("");try{o.$replyholder.find(".redactor_conversation_editor_"+o.options.cnvID).redactor("set","")}catch(e){}}else{"date_desc"==o.options.orderBy?o.$messages.prepend(a):o.$messages.append(a),o.$element.find(".ccm-conversation-no-messages").hide(),o.$newmessageform.find(".conversation-editor").val("");try{o.$newmessageform.find(".redactor_conversation_editor_"+o.options.cnvID).redactor("set","")}catch(e){}}o.publish("conversationAddMessageFromJSON",{json:n,form:e}),o.updateCount();var s=t("a#cnv"+o.options.cnvID+"Message"+n.cnvMessageID).offset();t(".dropdown-toggle").dropdown(),t("html, body").animate({scrollTop:s.top},800,"linear")}})},updateMessageFromJSON:function(e,n){var o=""!=this.options.addMessageToken?1:0,a=[{name:"cnvMessageID",value:n.cnvMessageID},{name:"enablePosting",value:o},{name:"displayMode",value:this.options.displayMode},{name:"enableCommentRating",value:this.options.enableCommentRating},{name:"displaySocialLinks",value:this.options.displaySocialLinks}];t.ajax({type:"post",data:a,url:CCM_TOOLS_PATH+"/conversations/message_detail",success:function(e){t("[data-conversation-message-id="+n.cnvMessageID+"]").after(e).remove(),t(".dropdown-toggle").dropdown()}})},updateCount:function(){var e=this;e.publish("conversationBeforeUpdateCount"),e.$messagecnt.load(CCM_TOOLS_PATH+"/conversations/count_header",{cnvID:e.options.cnvID},(function(){e.publish("conversationUpdateCount")}))},submitForm:function(e){var n=this;n.publish("conversationBeforeSubmitForm");var o=e.closest("form");e.prop("disabled",!0),o.parent().addClass("ccm-conversation-form-submitted");var a=o.serializeArray(),i=e.attr("data-post-parent-id");a.push({name:"token",value:n.options.addMessageToken},{name:"cnvID",value:n.options.cnvID},{name:"cnvMessageParentID",value:i},{name:"enableRating",value:i}),t.ajax({dataType:"json",type:"post",data:a,url:CCM_TOOLS_PATH+"/conversations/add_message",success:function(e){return e?e.error?(n.handlePostError(o,e.errors),!1):(t(".preview.processing").each((function(){t('input[rel="'+t(this).attr("rel")+'"]').remove()})),t("form.dropzone").each((function(){var e=t(this).data("dropzone");t.each(e.files,(function(t,n){e.removeFile(n)}))})),n.addMessageFromJSON(o,e),void n.publish("conversationSubmitForm",{form:o,response:e})):(n.handlePostError(o),!1)},error:function(e){return n.handlePostError(o),!1},complete:function(t){e.prop("disabled",!1),o.parent().closest(".ccm-conversation-form-submitted").removeClass("ccm-conversation-form-submitted")}})},submitUpdateForm:function(e){var n=this;n.publish("conversationBeforeSubmitForm");var o=e.closest("form");e.prop("disabled",!0),o.parent().addClass("ccm-conversation-form-submitted");var a=o.serializeArray(),i=e.attr("data-post-message-id");a.push({name:"token",value:n.options.editMessageToken},{name:"cnvMessageID",value:i}),t.ajax({dataType:"json",type:"post",data:a,url:CCM_TOOLS_PATH+"/conversations/update_message",success:function(e){return e?e.error?(n.handlePostError(o,e.errors),!1):(t(".preview.processing").each((function(){t('input[rel="'+t(this).attr("rel")+'"]').remove()})),n.updateMessageFromJSON(o,e),void n.publish("conversationSubmitForm",{form:o,response:e})):(n.handlePostError(o),!1)},error:function(e){return n.handlePostError(o),!1},complete:function(t){e.prop("disabled",!1),o.parent().closest(".ccm-conversation-form-submitted").removeClass("ccm-conversation-form-submitted")}})},tool:{setCaretPosition:function(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()},getCaretPosition:function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),o=n.duplicate();return n.moveToBookmark(t.getBookmark()),o.setEndPoint("EndToStart",n),o.text.length}return 0},testMentionString:function(e){return/^@[a-z0-9]+$/.test(e)},getMentionMatches:function(e,t){return t.filter((function(t){return t.indexOf(e)>=0}))},isSameConversation:function(e,t){return e.options.blockID===t.options.blockID&&e.options.cnvID===t.options.cnvID},MentionUser:function(e){this.getName=function(){return e}}}}}(window,jQuery)},307:function(e,t){!function(e,t){"use strict";var n={Too_many_files:"Too many files",Invalid_file_extension:"Invalid file extension",Max_file_size_exceeded:"Max file size exceeded",Error_deleting_attachment:"Something went wrong while deleting this attachment, please refresh and try again.",Confirm_remove_attachment:"Remove this attachment?"},o={init:function(e){var o=e;return o.$element.on("click.cnv","a[data-toggle=conversation-reply]",(function(){t(".ccm-conversation-wrapper").concreteConversationAttachments("clearDropzoneQueues")})),o.$element.on("click.cnv","a.attachment-delete",(function(e){e.preventDefault(),t(this).concreteConversationAttachments("attachmentDeleteTrigger",o)})),o.$editMessageHolder&&!o.$editMessageHolder.find(".dropzone").attr("data-dropzone-applied")&&o.$editMessageHolder.find(".dropzone").not('[data-drozpone-applied="true"]').dropzone({url:CCM_TOOLS_PATH+"/conversations/add_file",success:function(e,n){var a=this;t(e.previewTemplate).click((function(){a.removeFile(e),t('input[rel="'+t(this).attr("rel")+'"]').remove()}));var i=JSON.parse(n);if(i.error){var s=t('.preview.processing[rel="'+i.timestamp+'"]').closest("form");o.handlePostError(s,[i.error]),t('.preview.processing[rel="'+i.timestamp+'"]').remove(),s.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",(function(){t(this).html("")}))}else t(this.element).closest("div.ccm-conversation-edit-message").find("form.aux-reply-form").append('<input rel="'+i.timestamp+'" type="hidden" name="attachments[]" value="'+i.id+'" />')},accept:function(e,a){var i=[],s=this.files.length;o.options.maxFiles>0&&s>o.options.maxFiles&&i.push(n.Too_many_files);var r=o.options.fileExtensions.split(",");if(e.name.split(".").pop().toLowerCase()&&-1==r.indexOf(e.name.split(".").pop().toLowerCase())&&""!=r&&i.push(n.Invalid_file_extension),o.options.maxFileSize>0&&e.size>1e6*o.options.maxFileSize&&i.push(n.Max_file_size_exceeded),i.length>0){t('input[rel="'+t(e.previewTemplate).attr("rel")+'"]').remove();var c=t(e.previewTemplate).parent(".dropzone");this.removeFile(e),o.handlePostError(c,i),c.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",(function(){t(this).html("")})),s=-1,a("error")}else a()},sending:function(e,n,a){t(e.previewTemplate).attr("rel",(new Date).getTime()),a.append("timestamp",t(e.previewTemplate).attr("rel")),a.append("tag",t(o.$editMessageHOlder).parent("div").attr("rel")),a.append("fileCount",t(o.$editMessageHolder).find('[name="attachments[]"]').length)},init:function(){t(this.element).data("dropzone",this)}}),o.$newmessageform.dropzone&&!t(o.$newmessageform).attr("data-dropzone-applied")&&(o.$newmessageform.dropzone({accept:function(e,a){var i=[],s=this.files.length;o.options.maxFiles>0&&s>o.options.maxFiles&&i.push(n.Too_many_files);var r=o.options.fileExtensions.split(",");if(e.name.split(".").pop().toLowerCase()&&-1==r.indexOf(e.name.split(".").pop().toLowerCase())&&""!=r&&i.push(n.Invalid_file_extension),o.options.maxFileSize>0&&e.size>1e6*o.options.maxFileSize&&i.push(n.Max_file_size_exceeded),i.length>0){t('input[rel="'+t(e.previewTemplate).attr("rel")+'"]').remove();var c=t(e.previewTemplate).parent(".dropzone");this.removeFile(e),o.handlePostError(c,i),c.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",(function(){t(this).html("")})),s=-1,a("error")}else a()},url:CCM_TOOLS_PATH+"/conversations/add_file",success:function(e,n){var a=this;t(e.previewTemplate).click((function(){t('input[rel="'+t(this).attr("rel")+'"]').remove(),a.removeFile(e)}));var i=JSON.parse(n);if(i.error){var s=t('.preview.processing[rel="'+i.timestamp+'"]').closest("form");o.handlePostError(s,[i.error]),t('.preview.processing[rel="'+i.timestamp+'"]').remove(),s.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",(function(){t(this).html("")}))}else t('div[rel="'+i.tag+'"] form.main-reply-form').append('<input rel="'+i.timestamp+'" type="hidden" name="attachments[]" value="'+i.id+'" />')},sending:function(e,n,a){t(e.previewTemplate).attr("rel",(new Date).getTime()),a.append("timestamp",t(e.previewTemplate).attr("rel")),a.append("tag",t(o.$newmessageform).parent("div").attr("rel")),a.append("fileCount",this.files.length)},init:function(){t(this.element).data("dropzone",this)}}),t(o.$newmessageform).attr("data-dropzone-applied","true")),t(o.$replyholder.find(".dropzone")).attr("data-dropzone-applied")||o.$replyholder.find(".dropzone").not('[data-drozpone-applied="true"]').dropzone({url:CCM_TOOLS_PATH+"/conversations/add_file",success:function(e,n){var a=this;t(e.previewTemplate).click((function(){a.removeFile(e),t('input[rel="'+t(this).attr("rel")+'"]').remove()}));var i=JSON.parse(n);if(i.error){var s=t('.preview.processing[rel="'+i.timestamp+'"]').closest("form");o.handlePostError(s,[i.error]),t('.preview.processing[rel="'+i.timestamp+'"]').remove(),s.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",(function(){t(this).html("")}))}else t(this.element).closest("div.ccm-conversation-add-reply").find("form.aux-reply-form").append('<input rel="'+i.timestamp+'" type="hidden" name="attachments[]" value="'+i.id+'" />')},accept:function(e,a){var i=[],s=this.files.length;o.options.maxFiles>0&&s>o.options.maxFiles&&i.push(n.Too_many_files);var r=o.options.fileExtensions.split(",");if(e.name.split(".").pop().toLowerCase()&&-1==r.indexOf(e.name.split(".").pop().toLowerCase())&&""!=r&&i.push(n.Invalid_file_extension),o.options.maxFileSize>0&&e.size>1e6*o.options.maxFileSize&&i.push(n.Max_file_size_exceeded),i.length>0){t('input[rel="'+t(e.previewTemplate).attr("rel")+'"]').remove();var c=t(e.previewTemplate).parent(".dropzone");this.removeFile(e),o.handlePostError(c,i),c.children(".ccm-conversation-errors").delay(3e3).fadeOut("slow",(function(){t(this).html("")})),s=-1,a("error")}else a()},sending:function(e,n,a){t(e.previewTemplate).attr("rel",(new Date).getTime()),a.append("timestamp",t(e.previewTemplate).attr("rel")),a.append("tag",t(o.$newmessageform).parent("div").attr("rel")),a.append("fileCount",t(o.$replyHolder).find('[name="attachments[]"]').length)},init:function(){t(this.element).data("dropzone",this)}}),t(o.$replyholder.find(".dropzone")).attr("data-dropzone-applied","true"),t.each(t(this),(function(e,n){t(this).find(".ccm-conversation-attachment-container").each((function(){t(this).is(":visible")&&t(this).toggle()}))}))},attachmentDeleteTrigger:function(e){var o=e,a=t(this);return o.$attachmentdeletetdialog=o.$attachmentdeleteholder.clone(),o.$attachmentdeletetdialog.dialog?o.$attachmentdeletetdialog.dialog({modal:!0,dialogClass:"ccm-conversation-dialog",title:o.$attachmentdeletetdialog.attr("data-dialog-title"),buttons:[{text:o.$attachmentdeleteholder.attr("data-cancel-button-title"),class:"btn pull-left",click:function(){o.$attachmentdeletetdialog.dialog("close")}},{text:o.$attachmentdeleteholder.attr("data-confirm-button-title"),class:"btn pull-right btn-danger",click:function(){t(this).concreteConversationAttachments("deleteAttachment",{cnvMessageAttachmentID:a.attr("rel"),cnvObj:o,dialogObj:o.$attachmentdeletetdialog})}}]}):window.confirm(n.Confirm_remove_attachment)&&t(this).concreteConversationAttachments("deleteAttachment",{cnvMessageAttachmentID:a.attr("rel"),cnvObj:o,dialogObj:o.$attachmentdeletetdialog}),!1},clearDropzoneQueues:function(){t(".preview.processing").each((function(){t('input[rel="'+t(this).attr("rel")+'"]').remove()})),t("form.dropzone").each((function(){var e=t(this).data("dropzone");t.each(e.files,(function(t,n){e.removeFile(n)}))}))},deleteAttachment:function(e){var o=e.cnvMessageAttachmentID,a=e.cnvObj,i=e.dialogObj,s=[{name:"cnvMessageAttachmentID",value:o}];t.ajax({type:"post",data:s,url:CCM_TOOLS_PATH+"/conversations/delete_file",success:function(e){var n=JSON.parse(e);t('p[rel="'+n.attachmentID+'"]').parent(".attachment-container").fadeOut(300,(function(){t(this).remove()})),i.dialog&&(i.dialog("close"),a.publish("conversationDeleteAttachment",{cnvMessageAttachmentID:o}))},error:function(e){a.publish("conversationDeleteAttachmentError",{cnvMessageAttachmentID:o,error:arguments}),window.alert(n.Error_deleting_attachment)}})}};t.fn.concreteConversationAttachments=function(e){return o[e]?o[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on concreteConversationAttachments"):o.init.apply(this,arguments)},t.fn.concreteConversationAttachments.localize=function(e){t.extend(!0,n,e)}}(window,jQuery)}});